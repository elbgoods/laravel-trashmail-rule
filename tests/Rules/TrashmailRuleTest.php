<?php

namespace Elbgoods\TrashmailRule\Tests\Rules;

use Elbgoods\TrashmailRule\Rules\TrashmailRule;
use Elbgoods\TrashmailRule\Tests\TestCase;
use Illuminate\Support\Arr;

final class TrashmailRuleTest extends TestCase
{
    /** @test */
    public function it_validates_the_email_domain(): void
    {
        $this->app['config']->set('trashmail.disposable_email_detector.enabled', true);
        $this->app['config']->set('trashmail.dead_letter.enabled', true);

        $rule = new TrashmailRule();

        $this->assertFalse($rule->passes('email', 'example@fakeinbox.com'));
        $this->assertTrue($rule->passes('email', 'example@gmail.com'));
    }

    /**
     * @test
     * @dataProvider provideTrashMailDomain
     */
    public function it_fails_known_trashmail_providers(string $domain): void
    {
        $this->app['config']->set('trashmail.disposable_email_detector.enabled', true);
        $this->app['config']->set('trashmail.dead_letter.enabled', true);
        $this->app['config']->set('trashmail.blacklist', $this->trashMailDomains());

        $rule = new TrashmailRule();

        $this->assertFalse($rule->passes('email', 'example@'.$domain));
    }

    /** @test */
    public function it_passes_whitelist_addresses(): void
    {
        $domain = Arr::random($this->trashMailDomains());
        $this->app['config']->set('trashmail.blacklist', $this->trashMailDomains());
        $this->app['config']->set('trashmail.whitelist', [$domain]);

        $rule = new TrashmailRule();

        $this->assertTrue($rule->passes('email', 'example@'.$domain));
    }

    public function provideTrashMailDomain(): array
    {
        return array_map(static function (string $domain): array {
            return [$domain];
        }, $this->trashMailDomains());
    }

    protected function trashMailDomains(): array
    {
        return [
            '0815.ru',
            '0wnd.net',
            '0wnd.org',
            '10minutemail.co.za',
            '10minutemail.com',
            '123-m.com',
            '1fsdfdsfsdf.tk',
            '1pad.de',
            '20minutemail.com',
            '21cn.com',
            '2fdgdfgdfgdf.tk',
            '2prong.com',
            '30minutemail.com',
            '33mail.com',
            '3trtretgfrfe.tk',
            '4gfdsgfdgfd.tk',
            '4warding.com',
            '5ghgfhfghfgh.tk',
            '6hjgjhgkilkj.tk',
            '6paq.com',
            '7tags.com',
            '9ox.net',
            'a-bc.net',
            'agedmail.com',
            'ama-trade.de',
            'amilegit.com',
            'amiri.net',
            'amiriindustries.com',
            'anonmails.de',
            'anonymbox.com',
            'antichef.com',
            'antichef.net',
            'antireg.ru',
            'antispam.de',
            'antispammail.de',
            'armyspy.com',
            'artman-conception.com',
            'azmeil.tk',
            'baxomale.ht.cx',
            'beefmilk.com',
            'bigstring.com',
            'binkmail.com',
            'bio-muesli.net',
            'bobmail.info',
            'bodhi.lawlita.com',
            'bofthew.com',
            'bootybay.de',
            'boun.cr',
            'bouncr.com',
            'breakthru.com',
            'brefmail.com',
            'bsnow.net',
            'bspamfree.org',
            'bugmenot.com',
            'bund.us',
            'burstmail.info',
            'buymoreplays.com',
            'byom.de',
            'c2.hu',
            'card.zp.ua',
            'casualdx.com',
            'cek.pm',
            'centermail.com',
            'centermail.net',
            'chammy.info',
            'childsavetrust.org',
            'chogmail.com',
            'choicemail1.com',
            'clixser.com',
            'cmail.net',
            'cmail.org',
            'coldemail.info',
            'cool.fr.nf',
            'courriel.fr.nf',
            'courrieltemporaire.com',
            'crapmail.org',
            'cust.in',
            'cuvox.de',
            'd3p.dk',
            'dacoolest.com',
            'dandikmail.com',
            'dayrep.com',
            'dcemail.com',
            'deadaddress.com',
            'deadspam.com',
            'delikkt.de',
            'despam.it',
            'despammed.com',
            'devnullmail.com',
            'dfgh.net',
            'digitalsanctuary.com',
            'dingbone.com',
            'disposableaddress.com',
            'disposableemailaddresses.com',
            'disposableinbox.com',
            'dispose.it',
            'dispostable.com',
            'dodgeit.com',
            'dodgit.com',
            'donemail.ru',
            'dontreg.com',
            'dontsendmespam.de',
            'drdrb.net',
            'dump-email.info',
            'dumpandjunk.com',
            'dumpyemail.com',
            'e-mail.com',
            'e-mail.org',
            'e4ward.com',
            'easytrashmail.com',
            'einmalmail.de',
            'einrot.com',
            'eintagsmail.de',
            'emailgo.de',
            'emailias.com',
            'emaillime.com',
            'emailsensei.com',
            'emailtemporanea.com',
            'emailtemporanea.net',
            'emailtemporar.ro',
            'emailtemporario.com.br',
            'emailthe.net',
            'emailtmp.com',
            'emailwarden.com',
            'emailx.at.hm',
            'emailxfer.com',
            'emeil.in',
            'emeil.ir',
            'emz.net',
            'ero-tube.org',
            'evopo.com',
            'explodemail.com',
            'express.net.ua',
            'eyepaste.com',
            'fakeinbox.com',
            'fakeinformation.com',
            'fansworldwide.de',
            'fantasymail.de',
            'fightallspam.com',
            'filzmail.com',
            'fivemail.de',
            'fleckens.hu',
            'frapmail.com',
            'friendlymail.co.uk',
            'fuckingduh.com',
            'fudgerub.com',
            'fyii.de',
            'garliclife.com',
            'gehensiemirnichtaufdensack.de',
            'get2mail.fr',
            'getairmail.com',
            'getmails.eu',
            'getonemail.com',
            'giantmail.de',
            'girlsundertheinfluence.com',
            'gishpuppy.com',
            'gmial.com',
            'goemailgo.com',
            'gotmail.net',
            'gotmail.org',
            'gotti.otherinbox.com',
            'great-host.in',
            'greensloth.com',
            'grr.la',
            'gsrv.co.uk',
            'guerillamail.biz',
            'guerillamail.com',
            'guerrillamail.biz',
            'guerrillamail.com',
            'guerrillamail.de',
            'guerrillamail.info',
            'guerrillamail.net',
            'guerrillamail.org',
            'guerrillamailblock.com',
            'gustr.com',
            'harakirimail.com',
            'hat-geld.de',
            'hatespam.org',
            'herp.in',
            'hidemail.de',
            'hidzz.com',
            'hmamail.com',
            'hopemail.biz',
            'ieh-mail.de',
            'ikbenspamvrij.nl',
            'imails.info',
            'inbax.tk',
            'inbox.si',
            'inboxalias.com',
            'inboxclean.com',
            'inboxclean.org',
            'infocom.zp.ua',
            'instant-mail.de',
            'ip6.li',
            'irish2me.com',
            'iwi.net',
            'jetable.com',
            'jetable.fr.nf',
            'jetable.net',
            'jetable.org',
            'jnxjn.com',
            'jourrapide.com',
            'jsrsolutions.com',
            'kasmail.com',
            'kaspop.com',
            'killmail.com',
            'killmail.net',
            'klassmaster.com',
            'klzlk.com',
            'koszmail.pl',
            'kurzepost.de',
            'lawlita.com',
            'letthemeatspam.com',
            'lhsdv.com',
            'lifebyfood.com',
            'link2mail.net',
            'litedrop.com',
            'lol.ovpn.to',
            'lolfreak.net',
            'lookugly.com',
            'lortemail.dk',
            'lr78.com',
            'lroid.com',
            'lukop.dk',
            'm21.cc',
            'mail-filter.com',
            'mail-temporaire.fr',
            'mail.by',
            'mail.mezimages.net',
            'mail.zp.ua',
            'mail1a.de',
            'mail21.cc',
            'mail2rss.org',
            'mail333.com',
            'mailbidon.com',
            'mailbiz.biz',
            'mailblocks.com',
            'mailbucket.org',
            'mailcat.biz',
            'mailcatch.com',
            'mailde.de',
            'mailde.info',
            'maildrop.cc',
            'maileimer.de',
            'mailexpire.com',
            'mailfa.tk',
            'mailforspam.com',
            'mailfreeonline.com',
            'mailguard.me',
            'mailin8r.com',
            'mailinater.com',
            'mailinator.com',
            'mailinator.net',
            'mailinator.org',
            'mailinator2.com',
            'mailincubator.com',
            'mailismagic.com',
            'mailme.lv',
            'mailme24.com',
            'mailmetrash.com',
            'mailmoat.com',
            'mailms.com',
            'mailnesia.com',
            'mailnull.com',
            'mailorg.org',
            'mailpick.biz',
            'mailrock.biz',
            'mailscrap.com',
            'mailshell.com',
            'mailsiphon.com',
            'mailtemp.info',
            'mailtome.de',
            'mailtothis.com',
            'mailtrash.net',
            'mailtv.net',
            'mailtv.tv',
            'mailzilla.com',
            'makemetheking.com',
            'manybrain.com',
            'mbx.cc',
            'mega.zik.dj',
            'meinspamschutz.de',
            'meltmail.com',
            'messagebeamer.de',
            'mezimages.net',
            'ministry-of-silly-walks.de',
            'mintemail.com',
            'misterpinball.de',
            'moncourrier.fr.nf',
            'monemail.fr.nf',
            'monmail.fr.nf',
            'monumentmail.com',
            'mt2009.com',
            'mt2014.com',
            'mycard.net.ua',
            'mycleaninbox.net',
            'mymail-in.net',
            'mypacks.net',
            'mypartyclip.de',
            'myphantomemail.com',
            'mysamp.de',
            'mytempemail.com',
            'mytempmail.com',
            'mytrashmail.com',
            'nabuma.com',
            'neomailbox.com',
            'nepwk.com',
            'nervmich.net',
            'nervtmich.net',
            'netmails.com',
            'netmails.net',
            'neverbox.com',
            'nice-4u.com',
            'nincsmail.hu',
            'nnh.com',
            'no-spam.ws',
            'noblepioneer.com',
            'nomail.pw',
            'nomail.xl.cx',
            'nomail2me.com',
            'nomorespamemails.com',
            'nospam.ze.tc',
            'nospam4.us',
            'nospamfor.us',
            'nospammail.net',
            'notmailinator.com',
            'nowhere.org',
            'nowmymail.com',
            'nurfuerspam.de',
            'nus.edu.sg',
            'objectmail.com',
            'obobbo.com',
            'odnorazovoe.ru',
            'oneoffemail.com',
            'onewaymail.com',
            'onlatedotcom.info',
            'online.ms',
            'opayq.com',
            'ordinaryamerican.net',
            'otherinbox.com',
            'ovpn.to',
            'owlpic.com',
            'pancakemail.com',
            'pcusers.otherinbox.com',
            'pjjkp.com',
            'plexolan.de',
            'poczta.onet.pl',
            'politikerclub.de',
            'poofy.org',
            'pookmail.com',
            'privacy.net',
            'privatdemail.net',
            'proxymail.eu',
            'prtnx.com',
            'putthisinyourspamdatabase.com',
            'qq.com',
            'quickinbox.com',
            'rcpt.at',
            'reallymymail.com',
            'realtyalerts.ca',
            'recode.me',
            'recursor.net',
            'reliable-mail.com',
            'rhyta.com',
            'rmqkr.net',
            'royal.net',
            'rtrtr.com',
            's0ny.net',
            'safe-mail.net',
            'safersignup.de',
            'safetymail.info',
            'safetypost.de',
            'saynotospams.com',
            'schafmail.de',
            'schrott-email.de',
            'secretemail.de',
            'secure-mail.biz',
            'senseless-entertainment.com',
            'services391.com',
            'sharklasers.com',
            'shieldemail.com',
            'shiftmail.com',
            'shitmail.me',
            'shitware.nl',
            'shmeriously.com',
            'shortmail.net',
            'sibmail.com',
            'sinnlos-mail.de',
            'slapsfromlastnight.com',
            'slaskpost.se',
            'smashmail.de',
            'smellfear.com',
            'snakemail.com',
            'sneakemail.com',
            'sneakmail.de',
            'snkmail.com',
            'sofimail.com',
            'solvemail.info',
            'sogetthis.com',
            'soodonims.com',
            'spam4.me',
            'spamail.de',
            'spamarrest.com',
            'spambob.net',
            'spambog.ru',
            'spambox.us',
            'spamcannon.com',
            'spamcannon.net',
            'spamcon.org',
            'spamcorptastic.com',
            'spamcowboy.com',
            'spamcowboy.net',
            'spamcowboy.org',
            'spamday.com',
            'spamex.com',
            'spamfree.eu',
            'spamfree24.com',
            'spamfree24.de',
            'spamfree24.org',
            'spamgoes.in',
            'spamgourmet.com',
            'spamgourmet.net',
            'spamgourmet.org',
            'spamherelots.com',
            'spamhereplease.com',
            'spamhole.com',
            'spamify.com',
            'spaml.de',
            'spammotel.com',
            'spamobox.com',
            'spamslicer.com',
            'spamspot.com',
            'spamthis.co.uk',
            'spamtroll.net',
            'speed.1s.fr',
            'spoofmail.de',
            'stuffmail.de',
            'super-auswahl.de',
            'supergreatmail.com',
            'supermailer.jp',
            'superrito.com',
            'superstachel.de',
            'suremail.info',
            'talkinator.com',
            'teewars.org',
            'teleworm.com',
            'teleworm.us',
            'temp-mail.org',
            'temp-mail.ru',
            'tempe-mail.com',
            'tempemail.co.za',
            'tempemail.com',
            'tempemail.net',
            'tempinbox.co.uk',
            'tempinbox.com',
            'tempmail.eu',
            'tempmaildemo.com',
            'tempmailer.com',
            'tempmailer.de',
            'tempomail.fr',
            'temporaryemail.net',
            'temporaryforwarding.com',
            'temporaryinbox.com',
            'temporarymailaddress.com',
            'tempthe.net',
            'thankyou2010.com',
            'thc.st',
            'thelimestones.com',
            'thisisnotmyrealemail.com',
            'thismail.net',
            'throwawayemailaddress.com',
            'tilien.com',
            'tittbit.in',
            'tizi.com',
            'tmailinator.com',
            'toomail.biz',
            'topranklist.de',
            'tradermail.info',
            'trash-mail.at',
            'trash-mail.com',
            'trash-mail.de',
            'trash2009.com',
            'trashdevil.com',
            'trashemail.de',
            'trashmail.at',
            'trashmail.com',
            'trashmail.de',
            'trashmail.me',
            'trashmail.net',
            'trashmail.org',
            'trashymail.com',
            'trialmail.de',
            'trillianpro.com',
            'twinmail.de',
            'tyldd.com',
            'uggsrock.com',
            'umail.net',
            'uroid.com',
            'us.af',
            'venompen.com',
            'veryrealemail.com',
            'viditag.com',
            'viralplays.com',
            'vpn.st',
            'vsimcard.com',
            'vubby.com',
            'wasteland.rfc822.org',
            'webemail.me',
            'weg-werf-email.de',
            'wegwerf-emails.de',
            'wegwerfadresse.de',
            'wegwerfemail.com',
            'wegwerfemail.de',
            'wegwerfmail.de',
            'wegwerfmail.info',
            'wegwerfmail.net',
            'wegwerfmail.org',
            'wh4f.org',
            'whyspam.me',
            'willhackforfood.biz',
            'willselfdestruct.com',
            'winemaven.info',
            'wronghead.com',
            'www.e4ward.com',
            'www.mailinator.com',
            'wwwnew.eu',
            'x.ip6.li',
            'xagloo.com',
            'xemaps.com',
            'xents.com',
            'xmaily.com',
            'xoxy.net',
            'yep.it',
            'yogamaven.com',
            'yopmail.com',
            'yopmail.fr',
            'yopmail.net',
            'yourdomain.com',
            'yuurok.com',
            'z1p.biz',
            'za.com',
            'zehnminuten.de',
            'zehnminutenmail.de',
            'zippymail.info',
            'zoemail.net',
            'zomg.info',
            '0-mail.com',
            '0clickemail.com',
            '3d-painting.com',
            '4warding.net',
            '4warding.org',
            '60minutemail.com',
            '675hosting.com',
            '675hosting.net',
            '675hosting.org',
            '6url.com',
            '75hosting.com',
            '75hosting.net',
            '75hosting.org',
            'afrobacon.com',
            'ajaxapp.net',
            'anonbox.net',
            'broadbandninja.com',
            'bumpymail.com',
            'correo.blogos.net',
            'cosmorph.com',
            'cubiclink.com',
            'curryworld.de',
            'discardmail.com',
            'discardmail.de',
            'emailmiser.com',
            'disposeamail.com',
            'disposemail.com',
            'dm.w3internet.co.ukexample.com',
            'dodgit.org',
            'dumpmail.de',
            'email60.com',
            'emaildienst.de',
            'emailigo.de',
            'emailinfive.com',
            'emailmiser.com',
            'emailto.de',
            'enterto.com',
            'ephemail.net',
            'etranquil.com',
            'etranquil.net',
            'etranquil.org',
            'fastacura.com',
            'fastchevy.com',
            'fastchrysler.com',
            'fastkawasaki.com',
            'fastmazda.com',
            'fastmitsubishi.com',
            'fastnissan.com',
            'fastsubaru.com',
            'fastsuzuki.com',
            'fasttoyota.com',
            'fastyamaha.com',
            'fizmail.com',
            'fr33mail.info',
            'front14.org',
            'fux0ringduh.com',
            'get1mail.com',
            'getonemail.net',
            'ghosttexter.de',
            'gowikibooks.com',
            'gowikicampus.com',
            'gowikicars.com',
            'gowikifilms.com',
            'gowikigames.com',
            'gowikimusic.com',
            'gowikinetwork.com',
            'gowikitravel.com',
            'gowikitv.com',
            'guerillamail.net',
            'guerillamail.org',
            'h.mintemail.com',
            'h8s.org',
            'haltospam.com',
            'hochsitze.com',
            'hotpop.com',
            'hulapla.de',
            'ieatspam.eu',
            'ieatspam.info',
            'ihateyoualot.info',
            'iheartspam.org',
            'incognitomail.com',
            'incognitomail.net',
            'incognitomail.org',
            'insorg-mail.info',
            'ipoo.org',
            'junk1e.com',
            'keepmymail.com',
            'kir.ch.tc',
            'klassmaster.net',
            'kulturbetrieb.info',
            'lopl.co.cc',
            'm4ilweb.info',
            'maboard.com',
            'mail4trash.com',
            'maileater.com',
            'mailme.ir',
            'mailnator.com',
            'mailslite.com',
            'mailzilla.org',
            'mierdamail.com',
            'moburl.com',
            'msa.minsmail.com',
            'mx0.wwwnew.eu',
            'myspaceinc.com',
            'myspaceinc.net',
            'myspaceinc.org',
            'myspacepimpedup.com',
            'myspamless.com',
            'netzidiot.de',
            'nobulk.com',
            'noclickemail.com',
            'nogmailspam.info',
            'nospamthanks.info',
            'nwldx.com',
            'oopi.org',
            'ourklips.com',
            'outlawspam.com',
            'pimpedupmyspace.com',
            'punkass.com',
            'PutThisInYourSpamDatabase.com',
            'regbypass.com',
            'regbypass.comsafe-mail.net',
            'rejectmail.com',
            'rklips.com',
            'rppkn.com',
            'sandelf.de',
            'selfdestructingmail.com',
            'SendSpamHere.com',
            'skeefmail.com',
            'slopsbox.com',
            'sofort-mail.de',
            'spam.la',
            'spam.su',
            'spamavert.com',
            'spambob.com',
            'spambob.org',
            'spambog.com',
            'spambog.de',
            'spambox.info',
            'spambox.irishspringrealty.com',
            'spamcero.com',
            'spamfree24.eu',
            'spamfree24.info',
            'spamfree24.net',
            'SpamHereLots.com',
            'SpamHerePlease.com',
            'spaminator.de',
            'spamkill.info',
            'spaml.com',
            'spamoff.de',
            'spamthisplease.com',
            'spamtrail.com',
            'tempalias.com',
            'tempemail.biz',
            'TempEMail.net',
            'tempmail.it',
            'tempmail2.com',
            'temporarily.de',
            'temporarioemail.com.br',
            'thanksnospam.info',
            'trash-amil.com',
            'trashmail.ws',
            'trashmailer.com',
            'trashymail.net',
            'turual.com',
            'upliftnow.com',
            'uplipht.com',
            'viewcastmedia.com',
            'viewcastmedia.net',
            'viewcastmedia.org',
            'webm4il.info',
            'wetrainbayarea.com',
            'wetrainbayarea.org',
            'wuzup.net',
            'wuzupmail.net',
            'www.gishpuppy.com',
            'ypmail.webarnak.fr.eu.org',
            'zoaxe.com',
            'zoemail.org',
            'tagyourself.com',
            'whatpaas.com',
            'drdrb.com',
        ];
    }
}
